#! /bin/bash
# BRIX
# Concatenation d'un ensemble de fichiers vidéos ProRes en un seul

# accéder au dossier en question
# D'après Nejib  
echo "Indiquer l'adresse du clip :"
read ad
cd $ad

# détermination du clipname parmi les éléments du dossier
# clipname = nom du premier élément.mov présent dans le dossier ad
clipnames=$(basename $ad/*.mov)
clipname=$(echo ${clipnames} | awk {'print $1'})

# vider le fichier temporaire medias.txt pour éviter l'addition des lignes, puis repérer les différents éléments
  ## trouver un moyen de nommer le fichier txt selon le clipname d'origine

rm medias.txt
for f in $ad/*.mov; do echo "file '$f'" >> medias.txt; done

# obtenir un timecode pour un fichier donné et l'enregistrer
timecode=$(ffprobe -v error -select_streams v:0 -show_entries stream_tags=timecode -of default=noprint_wrappers=1:nokey=1 media_1.mov)

# concatener les éléments listés dans le fichier medias.txt
ffmpeg -f concat -i medias.txt -vcodec copy -acodec copy -timecode $timecode $clipname.mov

#	    problèmes à régler :
# - récurrence du processus sur un ensemble de medias
# - trouver les médias automatiquement
# - déterminer l'emplacement des sorties automatiquement
